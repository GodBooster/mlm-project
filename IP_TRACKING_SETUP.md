# üîç –ù–ê–°–¢–†–û–ô–ö–ê –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–Ø IP –ê–î–†–ï–°–û–í

## üìã **–ß–¢–û –î–û–ë–ê–í–õ–ï–ù–û:**

### **1. –ù–æ–≤—ã–µ –ø–æ–ª—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:**
- **`User.registrationIp`** - IP –∞–¥—Ä–µ—Å –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- **`User.lastLoginIp`** - IP –∞–¥—Ä–µ—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
- **`PendingRegistration.registrationIp`** - IP –∞–¥—Ä–µ—Å –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### **2. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ** IP –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- ‚úÖ **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ IP** –ø—Ä–∏ –∫–∞–∂–¥–æ–º –≤—Ö–æ–¥–µ
- ‚úÖ **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–æ–∫—Å–∏** (Cloudflare, Nginx)
- ‚úÖ **Fallback –∑–Ω–∞—á–µ–Ω–∏—è** –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö IP

## üöÄ **–ü–†–ò–ú–ï–ù–ï–ù–ò–ï –ò–ó–ú–ï–ù–ï–ù–ò–ô:**

### **1. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é:**
```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
cd /opt/mlm-project/backend
npx prisma migrate deploy
```

### **2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä:**
```bash
pm2 restart mlm-backend
```

### **3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
pm2 logs mlm-backend

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
npx prisma studio
```

## üìä **–ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –î–ê–ù–ù–´–•:**

### **1. –ê–Ω–∞–ª–∏–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π:**
```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ IP
SELECT registrationIp, COUNT(*) as registrations 
FROM "User" 
WHERE registrationIp IS NOT NULL 
GROUP BY registrationIp 
ORDER BY registrations DESC;

-- –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ IP (–º–Ω–æ–≥–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π)
SELECT registrationIp, COUNT(*) as registrations 
FROM "User" 
WHERE registrationIp IS NOT NULL 
GROUP BY registrationIp 
HAVING COUNT(*) > 3 
ORDER BY registrations DESC;
```

### **2. –ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑:**
```sql
-- IP –∞–¥—Ä–µ—Å–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏
SELECT email, registrationIp, lastLoginIp, createdAt 
FROM "User" 
WHERE registrationIp IS NOT NULL 
ORDER BY createdAt DESC;
```

### **3. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
```sql
-- IP —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –∞–∫–∫–∞—É–Ω—Ç–∞–º–∏
SELECT registrationIp, COUNT(*) as accounts 
FROM "User" 
WHERE registrationIp IS NOT NULL 
GROUP BY registrationIp 
HAVING COUNT(*) > 1 
ORDER BY accounts DESC;
```

## üõ°Ô∏è **–ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨:**

### **1. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö IP:**
```bash
# –î–æ–±–∞–≤–∏—Ç—å –≤ Fail2ban
echo "banned-ip-1" >> /etc/fail2ban/jail.local
echo "banned-ip-2" >> /etc/fail2ban/jail.local
```

### **2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
```bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö IP
node monitor-suspicious-ips.js
```

## üìà **–ê–î–ú–ò–ù –ü–ê–ù–ï–õ–¨:**

### **1. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ IP –≤ –∞–¥–º–∏–Ω–∫–µ:**
- –î–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫–∏ IP –≤ —Ç–∞–±–ª–∏—Ü—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ IP
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ IP

### **2. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:**
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è—Ö —Å –æ–¥–Ω–æ–≥–æ IP
- –ê–ª–µ—Ä—Ç—ã –æ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

## üîß **–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò:**

### **1. –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è IP:**
```javascript
// –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
import geoip from 'geoip-lite';

const getLocation = (ip) => {
  const geo = geoip.lookup(ip);
  return geo ? `${geo.country}, ${geo.region}` : 'Unknown';
};
```

### **2. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º:**
```javascript
// –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω
const blockedCountries = ['XX', 'YY'];
const userCountry = getLocation(ip).split(',')[0];

if (blockedCountries.includes(userCountry)) {
  return res.status(403).json({ error: 'Access denied from your location' });
}
```

## ‚úÖ **–†–ï–ó–£–õ–¨–¢–ê–¢:**

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- ‚úÖ **–í—Å–µ –Ω–æ–≤—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏** –±—É–¥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å IP –∞–¥—Ä–µ—Å
- ‚úÖ **–í—Å–µ –≤—Ö–æ–¥—ã** –±—É–¥—É—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å IP –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤—Ö–æ–¥–∞
- ‚úÖ **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã** —Å–º–æ–≥—É—Ç –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ø–æ IP
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** —Å–º–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ IP

**IP –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ–º–æ–∂–µ—Ç –≤—ã—è–≤–ª—è—Ç—å –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —É–ª—É—á—à–∏—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã!** üõ°Ô∏è
