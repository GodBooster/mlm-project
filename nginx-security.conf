# Nginx Security Configuration
# Добавьте эти правила в ваш nginx.conf или в location блок

# Блокировка доступа к конфиденциальным файлам
location ~ /\.(env|git|config) {
    deny all;
    return 404;
}

# Блокировка Path Traversal атак
location ~ /\.\./ {
    deny all;
    return 404;
}

# Блокировка доступа к SMTP конфигурациям
location ~ /(smtp|mail|sendgrid)/.*\.(env|json|config) {
    deny all;
    return 404;
}

# Блокировка доступа к системным файлам
location ~ /(etc|var|tmp|proc)/ {
    deny all;
    return 404;
}

# Rate limiting для защиты от брутфорса
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
limit_req_zone $binary_remote_addr zone=login:10m rate=5r/m;

location /api/ {
    limit_req zone=api burst=20 nodelay;
    # ... остальные настройки
}

location /api/admin/login {
    limit_req zone=login burst=3 nodelay;
    # ... остальные настройки
}

# Блокировка подозрительных User-Agent
if ($http_user_agent ~* (bot|crawler|spider|scraper)) {
    return 403;
}

# Блокировка подозрительных запросов
if ($request_uri ~* "\.(env|git|config|json|sql|bak|backup)") {
    return 404;
}
