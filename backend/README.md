# MLM Investment Platform - Backend

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –≤ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω–æ–π –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ MLM.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –°–∏—Å—Ç–µ–º–∞ –û—á–µ—Ä–µ–¥–µ–π
- **Daily Profit** - –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è –ø–æ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–º –ø–∞–∫–µ—Ç–∞–º
- **Deposit** - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–ø–æ–∑–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å
- **Referral Bonus** - —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –±–æ–Ω—É—Å—ã
- **Rank Bonus** - –±–æ–Ω—É—Å—ã –∑–∞ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ —Ä–∞–Ω–≥–æ–≤
- **Rank Reward** - –Ω–∞–≥—Ä–∞–¥—ã –∑–∞ —Ä–∞–Ω–≥–∏
- **Bonus** - –æ–±—â–∏–µ –±–æ–Ω—É—Å—ã

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –¥–ª—è –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π (00:01 –∏ 12:01 UTC)
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 18+
- PostgreSQL 12+
- pg-boss –¥–ª—è –æ—á–µ—Ä–µ–¥–µ–π

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```bash
npm install
```

2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö PostgreSQL:**
```bash
# –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres psql
CREATE USER mlm_user WITH PASSWORD 'mlm_password';
CREATE DATABASE mlm_database;
GRANT ALL PRIVILEGES ON DATABASE mlm_database TO mlm_user;
\q
```

3. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env:**
```bash
DATABASE_URL="postgresql://mlm_user:mlm_password@localhost:5432/mlm_database"
PORT=3001
```

4. **–í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
```bash
npm run db:migrate
npm run db:generate
```

5. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:**
```bash
npm run db:seed
```

6. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä:**
```bash
npm start
```

## üìä API Endpoints

### –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
- `POST /api/investments` - —Å–æ–∑–¥–∞—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—é
- `GET /api/investments/user/:userId` - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/investments/stats/:userId` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π

### –†–µ—Ñ–µ—Ä–∞–ª—ã
- `POST /api/referrals/process` - –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª
- `GET /api/referrals/user/:userId` - –ø–æ–ª—É—á–∏—Ç—å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/referrals/stats/:userId` - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
- `GET /api/referrals/tree/:userId` - —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–µ –¥–µ—Ä–µ–≤–æ

### –†–∞–Ω–≥–∏
- `GET /api/ranks` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ —Ä–∞–Ω–≥–∏
- `GET /api/ranks/user/:userId` - –ø–æ–ª—É—á–∏—Ç—å —Ä–∞–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/ranks/update/:userId` - –æ–±–Ω–æ–≤–∏—Ç—å —Ä–∞–Ω–≥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/ranks/progress/:userId` - –ø—Ä–æ–≥—Ä–µ—Å—Å –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞–Ω–≥—É

### –û—á–µ—Ä–µ–¥–∏
- `POST /api/queue/daily-profit/trigger` - –∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
- `POST /api/queue/bonus` - –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –±–æ–Ω—É—Å

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- `GET /api/users` - –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `POST /api/users` - —Å–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `GET /api/users/:id` - –ø–æ–ª—É—á–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –ü–∞–∫–µ—Ç—ã
- `GET /api/packages` - –ø–æ–ª—É—á–∏—Ç—å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–æ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
- `POST /api/packages` - —Å–æ–∑–¥–∞—Ç—å –ø–∞–∫–µ—Ç

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `GET /api/transactions/user/:userId` - –ø–æ–ª—É—á–∏—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üîß –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ü—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ jobs/
‚îÇ   ‚îú‚îÄ‚îÄ queue-manager.js    # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ scheduler.js        # –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á
‚îÇ   ‚îî‚îÄ‚îÄ bonus.js           # –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –±–æ–Ω—É—Å–æ–≤
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ investment-service.js  # –°–µ—Ä–≤–∏—Å –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ referral-service.js    # –°–µ—Ä–≤–∏—Å —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ rank-service.js        # –°–µ—Ä–≤–∏—Å —Ä–∞–Ω–≥–æ–≤
‚îú‚îÄ‚îÄ prisma/
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma       # –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ index.js               # –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ init-db.js            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îî‚îÄ‚îÄ package.json
```

## üìà –°–∏—Å—Ç–µ–º–∞ –†–∞–Ω–≥–æ–≤

| –†–∞–Ω–≥ | –†–µ—Ñ–µ—Ä–∞–ª—ã | –ò–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏ | –ë–æ–Ω—É—Å | –ù–∞–≥—Ä–∞–¥–∞ |
|------|----------|------------|-------|---------|
| BRONZE | 0 | $0 | $0 | $0 |
| SILVER | 5 | $1,000 | $50 | $100 |
| GOLD | 15 | $5,000 | $200 | $500 |
| PLATINUM | 30 | $15,000 | $500 | $1,500 |
| DIAMOND | 50 | $30,000 | $1,000 | $3,000 |

## ‚è∞ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ù–∞—á–∏—Å–ª–µ–Ω–∏–π

- **Daily Profit**: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 00:01 –∏ 12:01 UTC
- **Referral Bonus**: –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ —Ä–µ—Ñ–µ—Ä–∞–ª–∞
- **Rank Bonus**: –ø—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —Ä–∞–Ω–≥–∞
- **Rank Reward**: –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ —Ä–∞–Ω–≥–∞

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å:
- –£—Å–ø–µ—à–Ω—ã–µ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è
- –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –¥–ª—è –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∑–∞–¥–∞—á
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- Graceful shutdown –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã

## üìù –ü—Ä–∏–º–µ—Ä—ã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–∏
```javascript
const response = await fetch('/api/investments', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    userId: 1,
    packageId: 2,
    amount: 5000
  })
})
```

### –ó–∞–ø—É—Å–∫ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π
```javascript
const response = await fetch('/api/queue/daily-profit/trigger', {
  method: 'POST'
})
```

### –ü—É–±–ª–∏–∫–∞—Ü–∏—è –±–æ–Ω—É—Å–∞
```javascript
const response = await fetch('/api/queue/bonus', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    userId: 1,
    amount: 100,
    reason: 'Welcome bonus'
  })
})
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è —Å SQLite

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –±–∞–∑–∞ SQLite:

1. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ SQLite
2. –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≤ PostgreSQL
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ö–µ–º—É —á–µ—Ä–µ–∑ Prisma
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—á–µ—Ä–µ–¥–µ–π pg-boss 